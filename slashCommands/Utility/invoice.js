const _0x3c2087=(function(){let _0x43044d=!![];return function(_0x1dbbaf,_0x356829){const _0x302e7b=_0x43044d?function(){if(_0x356829){const _0x273ff1=_0x356829['apply'](_0x1dbbaf,arguments);return _0x356829=null,_0x273ff1;}}:function(){};return _0x43044d=![],_0x302e7b;};}()),_0x5b3d35=_0x3c2087(this,function(){return _0x5b3d35['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x5b3d35)['search']('(((.+)+)+)+$');});_0x5b3d35();const {SlashCommandBuilder}=require('@discordjs/builders'),{ActionRowBuilder,ButtonBuilder,EmbedBuilder}=require('discord.js'),Discord=require('discord.js'),fs=require('fs'),yaml=require('js-yaml'),config=yaml['load'](fs['readFileSync']('./config.yml','utf8')),commands=yaml['load'](fs['readFileSync']('./commands.yml','utf8')),utils=require('../../utils.js');module['exports']={'enabled':commands['Utility']['Invoice']['Enabled'],'data':new SlashCommandBuilder()['setName']('invoice')['setDescription'](commands['Utility']['Invoice']['Description'])['addSubcommand'](_0x2dd139=>_0x2dd139['setName']('paypal')['setDescription']('PayPal\x20Invoice')['addUserOption'](_0xccefb5=>_0xccefb5['setName']('user')['setDescription']('User')['setRequired'](!![]))['addIntegerOption'](_0x23b934=>_0x23b934['setName']('price')['setDescription']('Price')['setRequired'](!![]))['addStringOption'](_0x48099a=>_0x48099a['setName']('service')['setDescription']('Service')['setRequired'](!![])))['addSubcommand'](_0x1b17a3=>_0x1b17a3['setName']('stripe')['setDescription']('Stripe\x20Invoice')['addUserOption'](_0x371856=>_0x371856['setName']('user')['setDescription']('User')['setRequired'](!![]))['addStringOption'](_0x1f1a6d=>_0x1f1a6d['setName']('email')['setDescription']('Customer\x20Email')['setRequired'](!![]))['addIntegerOption'](_0x320a56=>_0x320a56['setName']('price')['setDescription']('Price')['setRequired'](!![]))['addStringOption'](_0x3e0093=>_0x3e0093['setName']('service')['setDescription']('Service')['setRequired'](!![]))),async 'execute'(_0x28b5b5,_0x144a9a){let _0x1b20b5=_0x28b5b5['options']['getSubcommand'](),_0x42b883=_0x28b5b5['options']['getUser']('user'),_0x3ff569=_0x28b5b5['options']['getInteger']('price'),_0x5ef022=_0x28b5b5['options']['getString']('service'),_0x3df0b1=_0x28b5b5['options']['getString']('email');if(_0x1b20b5==='paypal'){if(config['PayPalSettings']['Enabled']===![])return _0x28b5b5['reply']({'content':'This\x20command\x20has\x20been\x20disabled\x20in\x20the\x20config!','ephemeral':!![]});if(config['PayPalSettings']['OnlyInTicketChannels']&&!_0x144a9a['tickets']['has'](_0x28b5b5['channel']['id']))return _0x28b5b5['reply']({'content':config['Locale']['NotInTicketChannel'],'ephemeral':!![]});let _0x3d97cc=![];for(let _0x4497ee=0x0;_0x4497ee<config['PayPalSettings']['AllowedRoles']['length'];_0x4497ee++){role=_0x28b5b5['guild']['roles']['cache']['get'](config['PayPalSettings']['AllowedRoles'][_0x4497ee]);if(role&&_0x28b5b5['member']['roles']['cache']['has'](config['PayPalSettings']['AllowedRoles'][_0x4497ee]))_0x3d97cc=!![];}if(_0x3d97cc===![])return _0x28b5b5['reply']({'content':config['Locale']['NoPermsMessage'],'ephemeral':!![]});await _0x28b5b5['deferReply']();let _0x463583={'merchant_info':{'email':config['PayPalSettings']['Email'],'business_name':_0x28b5b5['guild']['name']},'items':[{'name':_0x5ef022,'quantity':0x1,'unit_price':{'currency':config['PayPalSettings']['Currency'],'value':_0x3ff569}}],'logo_url':_0x28b5b5['guild']['iconURL'](),'note':config['PayPalSettings']['Description'],'payment_term':{'term_type':'NET_45'},'tax_inclusive':![],'shipping_info':{}};_0x144a9a['paypal']['invoice']['create'](_0x463583,(_0xa2809a,_0x2bac28)=>{_0xa2809a?_0xa2809a['response']['error']==='invalid_client'?console['log']('\x1b[31m%s\x1b[0m','[ERROR]\x20The\x20PayPal\x20API\x20Credentials\x20you\x20specified\x20in\x20the\x20config\x20are\x20invalid!\x20Make\x20you\x20sure\x20you\x20use\x20the\x20\x22LIVE\x22\x20mode!'):console['log'](_0xa2809a):_0x144a9a['paypal']['invoice']['send'](_0x2bac28['id'],function(_0x772584,_0xbe5934){if(_0xa2809a)console['log'](_0xa2809a);else{const _0x554a36=new ActionRowBuilder()['addComponents'](new ButtonBuilder()['setStyle']('Link')['setURL']('https://www.paypal.com/invoice/payerView/details/'+_0x2bac28['id'])['setLabel'](config['Locale']['PayPalPayInvoice'])),_0x167933=new EmbedBuilder()['setTitle'](config['Locale']['PayPalInvoiceTitle'])['setColor'](config['EmbedColors'])['setThumbnail']('https://www.freepnglogos.com/uploads/paypal-logo-png-7.png')['setDescription'](config['Locale']['PayPalInvoiceMsg'])['addFields']([{'name':'â€¢\x20'+config['Locale']['suggestionInformation'],'value':'>\x20**'+config['Locale']['PayPalSeller']+'**\x20<@!'+_0x28b5b5['user']['id']+'>\x0a>\x20**'+config['Locale']['PayPalUser']+'**\x20<@!'+_0x42b883['id']+'>\x0a>\x20**'+config['Locale']['PayPalPrice']+'**\x20'+config['PayPalSettings']['CurrencySymbol']+_0x3ff569+'\x20('+config['PayPalSettings']['Currency']+')\x0a>\x20**'+config['Locale']['suggestionStatus']+'**\x20ðŸ”´\x20UNPAID'},{'name':'â€¢\x20'+config['Locale']['PayPalService'],'value':'>\x20```'+_0x5ef022+'```'}])['setTimestamp']()['setFooter']({'text':''+_0x42b883['username'],'iconURL':''+_0x42b883['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})});_0x28b5b5['editReply']({'embeds':[_0x167933],'components':[_0x554a36]})['then'](async function(_0x4f2ba3){await _0x144a9a['paypalInvoices']['ensure'](''+_0x2bac28['id'],{'userID':_0x42b883['id'],'sellerID':_0x28b5b5['user']['id'],'channelID':_0x28b5b5['channel']['id'],'messageID':_0x4f2ba3['id'],'invoiceID':_0x2bac28['id'],'price':_0x3ff569,'service':_0x5ef022,'status':_0x2bac28['status']});let _0x24e1b3;if(!config['paypalInvoice']['ChannelID'])_0x24e1b3=_0x28b5b5['guild']['channels']['cache']['get'](config['TicketSettings']['LogsChannelID']);if(config['paypalInvoice']['ChannelID'])_0x24e1b3=_0x28b5b5['guild']['channels']['cache']['get'](config['paypalInvoice']['ChannelID']);const _0x3b50c7=new EmbedBuilder()['setColor']('Green')['setTitle'](config['Locale']['PayPalLogTitle'])['addFields']([{'name':'â€¢\x20'+config['Locale']['logsExecutor'],'value':'>\x20<@!'+_0x28b5b5['user']['id']+'>\x0a>\x20'+_0x28b5b5['user']['username']},{'name':'â€¢\x20'+config['Locale']['PayPalUser'],'value':'>\x20<@!'+_0x42b883['id']+'>\x0a>\x20'+_0x42b883['username']},{'name':'â€¢\x20'+config['Locale']['PayPalPrice'],'value':'>\x20'+config['PayPalSettings']['CurrencySymbol']+_0x3ff569},{'name':'â€¢\x20'+config['Locale']['PayPalService'],'value':'>\x20'+_0x5ef022}])['setTimestamp']()['setThumbnail'](_0x28b5b5['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400}))['setFooter']({'text':''+_0x28b5b5['user']['username'],'iconURL':''+_0x28b5b5['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})});if(_0x24e1b3&&config['paypalInvoice']['Enabled'])_0x24e1b3['send']({'embeds':[_0x3b50c7]});let _0x6d5947=setInterval(async()=>{await utils['checkPayPalPayments']();if(await _0x144a9a['paypalInvoices']['get'](''+_0x2bac28['id'],'status')==='paid'){await clearInterval(_0x6d5947),await _0x144a9a['paypalInvoices']['delete'](_0x2bac28['id']);return;}if(await _0x144a9a['paypalInvoices']['get'](''+_0x2bac28['id'],'status')==='deleted'){await clearInterval(_0x6d5947),await _0x144a9a['paypalInvoices']['delete'](_0x2bac28['id']);return;}},0x7530);});}});});}else{if(_0x1b20b5==='stripe'){if(config['StripeSettings']['Enabled']===![])return _0x28b5b5['reply']({'content':'This\x20command\x20has\x20been\x20disabled\x20in\x20the\x20config!','ephemeral':!![]});if(config['StripeSettings']['OnlyInTicketChannels']&&!_0x144a9a['tickets']['has'](_0x28b5b5['channel']['id']))return _0x28b5b5['reply']({'content':config['Locale']['NotInTicketChannel'],'ephemeral':!![]});let _0x29d0c7=![];for(let _0x5dc58a=0x0;_0x5dc58a<config['StripeSettings']['AllowedRoles']['length'];_0x5dc58a++){role=_0x28b5b5['guild']['roles']['cache']['get'](config['StripeSettings']['AllowedRoles'][_0x5dc58a]);if(role&&_0x28b5b5['member']['roles']['cache']['has'](config['StripeSettings']['AllowedRoles'][_0x5dc58a]))_0x29d0c7=!![];}if(_0x29d0c7===![])return _0x28b5b5['reply']({'content':config['Locale']['NoPermsMessage'],'ephemeral':!![]});_0x3ff569=Math['round'](_0x3ff569);let _0x322335=_0x3ff569*0x64;await _0x28b5b5['deferReply'](),_0x144a9a['stripe']['customers']['create']({'email':_0x3df0b1,'name':_0x42b883['username'],'description':'Discord\x20User\x20ID:\x20'+_0x42b883['id']})['then'](_0x4be693=>{return _0x144a9a['stripe']['invoiceItems']['create']({'customer':_0x4be693['id'],'amount':_0x322335,'currency':config['StripeSettings']['Currency'],'description':_0x5ef022})['then'](_0x1f2ca4=>{return _0x144a9a['stripe']['invoices']['create']({'collection_method':'send_invoice','days_until_due':0x1e,'customer':_0x1f2ca4['customer']});})['then'](async _0x2b5cb5=>{await _0x144a9a['stripe']['invoices']['sendInvoice'](_0x2b5cb5['id']);let _0x5da19c=await _0x144a9a['stripe']['invoices']['retrieve'](_0x2b5cb5['id']);const _0x53e543=new Discord['ActionRowBuilder']()['addComponents'](new Discord['ButtonBuilder']()['setStyle']('Link')['setURL'](''+_0x5da19c['hosted_invoice_url'])['setLabel'](config['Locale']['PayPalPayInvoice'])),_0x1a6fd6=new Discord['EmbedBuilder']()['setTitle'](config['Locale']['StripeInvoiceTitle'])['setColor'](config['EmbedColors'])['setThumbnail']('https://assets.website-files.com/60d5e12b5c772dbf7315804e/6127ddadabd8205a78c21a42_sq.png')['setDescription'](config['Locale']['PayPalInvoiceMsg'])['addFields']([{'name':'â€¢\x20'+config['Locale']['suggestionInformation'],'value':'>\x20**'+config['Locale']['PayPalSeller']+'**\x20<@!'+_0x28b5b5['user']['id']+'>\x0a>\x20**'+config['Locale']['PayPalUser']+'**\x20<@!'+_0x42b883['id']+'>\x0a>\x20**'+config['Locale']['PayPalPrice']+'**\x20'+config['StripeSettings']['CurrencySymbol']+_0x3ff569+'\x20('+config['StripeSettings']['Currency']+')\x0a>\x20**'+config['Locale']['suggestionStatus']+'**\x20ðŸ”´\x20UNPAID'},{'name':'â€¢\x20'+config['Locale']['PayPalService'],'value':'>\x20```'+_0x5ef022+'```'}])['setTimestamp']()['setFooter']({'text':_0x42b883['username']+'#'+_0x42b883['discriminator'],'iconURL':''+_0x42b883['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})});_0x28b5b5['editReply']({'embeds':[_0x1a6fd6],'components':[_0x53e543]})['then'](async function(_0x461d11){let _0x47448c;if(!config['stripeInvoice']['ChannelID'])_0x47448c=_0x28b5b5['guild']['channels']['cache']['get'](config['TicketSettings']['LogsChannelID']);if(config['stripeInvoice']['ChannelID'])_0x47448c=_0x28b5b5['guild']['channels']['cache']['get'](config['stripeInvoice']['ChannelID']);const _0x1c4ee7=new Discord['EmbedBuilder']()['setColor']('Green')['setTitle'](config['Locale']['StripeLogTitle'])['addFields']([{'name':'â€¢\x20'+config['Locale']['logsExecutor'],'value':'>\x20<@!'+_0x28b5b5['user']['id']+'>\x0a>\x20'+_0x28b5b5['user']['username']},{'name':'â€¢\x20'+config['Locale']['PayPalUser'],'value':'>\x20<@!'+_0x42b883['id']+'>\x0a>\x20'+_0x42b883['username']},{'name':'â€¢\x20'+config['Locale']['PayPalPrice'],'value':'>\x20'+config['StripeSettings']['CurrencySymbol']+_0x3ff569},{'name':'â€¢\x20'+config['Locale']['PayPalService'],'value':'>\x20'+_0x5ef022}])['setTimestamp']()['setThumbnail'](_0x28b5b5['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400}))['setFooter']({'text':''+_0x28b5b5['user']['username'],'iconURL':''+_0x28b5b5['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})});if(_0x47448c&&config['stripeInvoice']['Enabled'])_0x47448c['send']({'embeds':[_0x1c4ee7]});await _0x144a9a['stripeInvoices']['ensure'](''+_0x5da19c['id'],{'userID':_0x42b883['id'],'sellerID':_0x28b5b5['user']['id'],'channelID':_0x28b5b5['channel']['id'],'messageID':_0x461d11['id'],'customerID':_0x5da19c['customer'],'invoiceID':_0x5da19c['id'],'price':_0x3ff569,'service':_0x5ef022,'status':_0x5da19c['status']});});let _0xf4302c=setInterval(async()=>{await utils['checkStripePayments']();if(await _0x144a9a['stripeInvoices']['get'](''+_0x5da19c['id'],'status')==='paid'){await clearInterval(_0xf4302c),await _0x144a9a['stripeInvoices']['delete'](_0x5da19c['id']);return;}if(await _0x144a9a['stripeInvoices']['get'](''+_0x5da19c['id'],'status')==='deleted'){await clearInterval(_0xf4302c),await _0x144a9a['stripeInvoices']['delete'](_0x5da19c['id']);return;}},0x7530);})['catch'](_0x5a695=>{console['log'](_0x5a695);});});}}}};