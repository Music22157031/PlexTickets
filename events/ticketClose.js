const _0x3ec375=(function(){let _0x1b0798=!![];return function(_0x596a0b,_0x26d838){const _0x28af4d=_0x1b0798?function(){if(_0x26d838){const _0x1bdbf9=_0x26d838['apply'](_0x596a0b,arguments);return _0x26d838=null,_0x1bdbf9;}}:function(){};return _0x1b0798=![],_0x28af4d;};}()),_0x2fb51a=_0x3ec375(this,function(){return _0x2fb51a['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x2fb51a)['search']('(((.+)+)+)+$');});_0x2fb51a();const {Discord,ActionRowBuilder,ButtonBuilder,EmbedBuilder,StringSelectMenuBuilder,Message,MessageAttachment,ModalBuilder,TextInputBuilder}=require('discord.js'),fs=require('fs'),yaml=require('js-yaml'),config=yaml['load'](fs['readFileSync']('./config.yml','utf8')),utils=require('../utils.js');module['exports']=async(_0x529c9f,_0xac9c6d)=>{await _0xac9c6d['deferReply']();async function _0x1d454e(){let _0x5acfa5=await utils['saveTranscript'](_0xac9c6d),_0xa7b574=await _0x529c9f['users']['cache']['get'](_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'userID')),_0x27cd21=await _0x529c9f['users']['cache']['get'](_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'closeUserID')),_0x43fba5=await _0x529c9f['users']['cache']['get'](_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'claimUser')),_0x481122=await _0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'messages');const _0x431065=new EmbedBuilder();_0x431065['setColor']('Red'),_0x431065['setTitle'](config['Locale']['ticketCloseTitle']);if(_0x27cd21)_0x431065['addFields']([{'name':'•\x20'+config['Locale']['logsClosedBy'],'value':'>\x20<@!'+_0x27cd21['id']+'>\x0a>\x20'+_0x27cd21['username']}]);if(config['ArchiveTickets']['Enabled'])_0x431065['addFields']([{'name':'•\x20'+config['Locale']['logsDeletedBy'],'value':'>\x20<@!'+_0xac9c6d['user']['id']+'>\x0a>\x20'+_0xac9c6d['user']['username']}]);_0x431065['addFields']([{'name':'•\x20'+config['Locale']['logsTicketAuthor'],'value':'>\x20<@!'+_0xa7b574['id']+'>\x0a>\x20'+_0xa7b574['username']}]);if(_0x43fba5&&config['ClaimingSystem']['Enabled'])_0x431065['addFields']([{'name':'•\x20'+config['Locale']['ticketClaimedBy'],'value':'>\x20<@!'+_0x43fba5['id']+'>\x0a>\x20'+_0x43fba5['username']}]);_0x431065['addFields']([{'name':'•\x20'+config['Locale']['logsTicket'],'value':'>\x20#'+_0xac9c6d['channel']['name']+'\x0a>\x20'+_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'ticketType')}]),_0x431065['setTimestamp'](),_0x431065['setThumbnail'](_0xac9c6d['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})),_0x431065['setFooter']({'text':config['Locale']['totalMessagesLog']+'\x20'+_0x481122,'iconURL':''+_0xac9c6d['user']['displayAvatarURL']({'format':'png','dynamic':!![],'size':0x400})});let _0x45928b;if(!config['ticketClose']['ChannelID'])_0x45928b=_0xac9c6d['guild']['channels']['cache']['get'](config['TicketSettings']['LogsChannelID']);if(config['ticketClose']['ChannelID'])_0x45928b=_0xac9c6d['guild']['channels']['cache']['get'](config['ticketClose']['ChannelID']);let _0x51138b;if(_0x45928b&&config['ticketClose']['Enabled']&&_0x481122<config['TicketTranscriptSettings']['MessagesRequirement'])await _0x45928b['send']({'embeds':[_0x431065]})['then'](async function(_0x5e47f8){_0x51138b=_0x5e47f8['id'];});if(_0x45928b&&config['ticketClose']['Enabled']&&_0x481122>=config['TicketTranscriptSettings']['MessagesRequirement'])await _0x45928b['send']({'embeds':[_0x431065],'files':[_0x5acfa5]})['then'](async function(_0x489d4c){_0x51138b=_0x489d4c['id'];});if(_0xa7b574){let _0xd7afb2=config['TicketUserCloseDM']['CloseEmbedMsg']['replace'](/{guildName}/g,''+_0xac9c6d['guild']['name'])['replace'](/{closedAt}/g,'<t:'+(Date['now']()/0x3e8|0x0)+':R>'),_0x548b48=config['TicketReviewSettings']['CloseEmbedReviewMsg']['replace'](/{guildName}/g,''+_0xac9c6d['guild']['name'])['replace'](/{closedAt}/g,'<t:'+(Date['now']()/0x3e8|0x0)+':R>');if(config['TicketUserCloseDM']['Enabled']!==![]||config['TicketReviewSettings']['Enabled']!==![])try{const _0x550d53=new ActionRowBuilder()['addComponents'](new StringSelectMenuBuilder()['setCustomId']('ratingSelect')['setPlaceholder'](config['Locale']['selectReview'])['setMinValues'](0x1)['setMaxValues'](0x1)['addOptions']([{'label':'5\x20Star','value':'five_star','emoji':'⭐'},{'label':'4\x20Star','value':'four_star','emoji':'⭐'},{'label':'3\x20Star','value':'three_star','emoji':'⭐'},{'label':'2\x20Star','value':'two_star','emoji':'⭐'},{'label':'1\x20Star','value':'one_star','emoji':'⭐'}]));if(!_0x43fba5)_0x43fba5=config['Locale']['notClaimedCloseDM'];const _0x1a29e0=new EmbedBuilder();_0x1a29e0['setTitle'](config['Locale']['ticketClosedCloseDM']),_0x1a29e0['setDescription'](_0xd7afb2);if(config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['TicketInformation'])_0x1a29e0['addFields']([{'name':''+config['Locale']['ticketInformationCloseDM'],'value':'>\x20'+config['Locale']['categoryCloseDM']+'\x20'+_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'ticketType')+'\x0a>\x20'+config['Locale']['claimedByCloseDM']+'\x20'+_0x43fba5+'\x0a>\x20'+config['Locale']['totalMessagesLog']+'\x20'+_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'messages')}]);_0x1a29e0['setColor'](config['EmbedColors']);const _0x5ecdf5=new EmbedBuilder();_0x5ecdf5['setTitle'](config['Locale']['ticketClosedCloseDM']),_0x5ecdf5['setDescription'](_0x548b48);if(config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['TicketInformation'])_0x5ecdf5['addFields']([{'name':''+config['Locale']['ticketInformationCloseDM'],'value':'>\x20'+config['Locale']['categoryCloseDM']+'\x20'+_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'ticketType')+'\x0a>\x20'+config['Locale']['claimedByCloseDM']+'\x20'+_0x43fba5+'\x0a>\x20'+config['Locale']['totalMessagesLog']+'\x20'+_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'messages')}]);_0x5ecdf5['setColor'](config['EmbedColors']);let _0x3c1f5e=!![];if(config['TicketReviewRequirements']['Enabled']){if(_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'messages')<config['TicketReviewRequirements']['TotalMessages'])_0x3c1f5e=![];}let _0x1227eb;if(config['TicketReviewSettings']['Enabled']&&_0x3c1f5e&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript'])await _0xa7b574['send']({'embeds':[_0x5ecdf5],'files':[_0x5acfa5],'components':[_0x550d53]})['then'](async function(_0x31039f){_0x1227eb=_0x31039f['id'];});if(config['TicketReviewSettings']['Enabled']&&_0x3c1f5e&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript']===![])await _0xa7b574['send']({'embeds':[_0x5ecdf5],'components':[_0x550d53]})['then'](async function(_0x121884){_0x1227eb=_0x121884['id'];});if(config['TicketReviewSettings']['Enabled']&&_0x3c1f5e&&config['TicketUserCloseDM']['Enabled']===![])await _0xa7b574['send']({'embeds':[_0x5ecdf5],'components':[_0x550d53]})['then'](async function(_0x479950){_0x1227eb=_0x479950['id'];});if(config['TicketReviewSettings']['Enabled']&&_0x3c1f5e===![]&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript'])await _0xa7b574['send']({'embeds':[_0x1a29e0],'files':[_0x5acfa5]})['then'](async function(_0x394912){_0x1227eb=_0x394912['id'];});if(config['TicketReviewSettings']['Enabled']&&_0x3c1f5e===![]&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript']===![])await _0xa7b574['send']({'embeds':[_0x1a29e0]})['then'](async function(_0x30d64c){_0x1227eb=_0x30d64c['id'];});if(config['TicketReviewSettings']['Enabled']===![]&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript'])await _0xa7b574['send']({'embeds':[_0x1a29e0],'files':[_0x5acfa5]});if(config['TicketReviewSettings']['Enabled']===![]&&config['TicketUserCloseDM']['Enabled']&&config['TicketUserCloseDM']['SendTranscript']===![])await _0xa7b574['send']({'embeds':[_0x1a29e0]});if(config['TicketReviewSettings']['Enabled'])_0x529c9f['reviewsData']['ensure'](''+_0x1227eb,{'ticketCreatorID':_0xa7b574['id'],'guildID':_0xac9c6d['guild']['id'],'userID':_0xa7b574['id'],'tCloseLogMsgID':_0x51138b,'reviewDMUserMsgID':_0x1227eb,'rating':0x0,'category':_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'ticketType'),'totalMessages':_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'messages')});}catch(_0x25dd0d){console['log']('\x1b[33m%s\x1b[0m','[INFO]\x20I\x20tried\x20to\x20DM\x20a\x20user,\x20but\x20their\x20DM\x27s\x20are\x20locked.');let _0x3173e4='\x0a\x0a['+new Date()['toLocaleString']()+']\x20[ERROR]\x20'+_0x25dd0d['stack'];await fs['appendFile']('./logs.txt',_0x3173e4,_0x4506d5=>{if(_0x4506d5)console['log'](_0x4506d5);});}}let _0x3a4069=config['TicketSettings']['DeleteTime']*0x3e8,_0x5922ff=config['Locale']['deletingTicketMsg']['replace'](/{time}/g,''+config['TicketSettings']['DeleteTime']);const _0x46390a=new EmbedBuilder()['setDescription'](_0x5922ff)['setColor']('Red'),_0x35aff3=new ButtonBuilder()['setCustomId']('closeTicket')['setLabel'](config['Locale']['CloseTicketButton'])['setStyle'](config['ButtonColors']['closeTicket'])['setEmoji'](config['ButtonEmojis']['closeTicket'])['setDisabled'](!![]);let _0x122dc7=new ActionRowBuilder()['addComponents'](_0x35aff3);await _0xac9c6d['channel']['messages']['fetch'](_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'msgID'))['then'](_0x3a7285=>{_0x3a7285['edit']({'components':[_0x122dc7]});});if(config['ArchiveTickets']['Enabled']===![])await _0xac9c6d['followUp']({'embeds':[_0x46390a]});setTimeout(async()=>{await _0xac9c6d['channel']['delete']()['catch'](_0x171607=>{});},_0x3a4069);let _0x32a219='\x0a\x0a['+new Date()['toLocaleString']()+']\x20[TICKET\x20CLOSED]\x20A\x20ticket\x20has\x20been\x20successfully\x20closed';fs['appendFile']('./logs.txt',_0x32a219,_0x57dffb=>{if(_0x57dffb)console['log'](_0x57dffb);});let _0x1cfc3e=_0x529c9f['guilds']['cache']['get'](_0xac9c6d['guild']['id'])['channels']['cache']['filter'](_0x2723e8=>_0x529c9f['tickets']['has'](_0x2723e8['id']))['size'],_0x4ef57b=_0x529c9f['globalStats']['get'](''+_0xac9c6d['guild']['id'],'openTickets');_0x4ef57b!==_0x1cfc3e&&_0x529c9f['globalStats']['set'](_0xac9c6d['guild']['id'],_0x1cfc3e,'openTickets');}async function _0x42c3b5(){let _0x2dc377=_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'button'),_0x489024=_0x529c9f['users']['cache']['get'](_0x529c9f['tickets']['get'](''+_0xac9c6d['channel']['id'],'userID'));const _0x1a5c72=new ButtonBuilder()['setCustomId']('reOpen')['setLabel'](config['Locale']['reOpenButton'])['setEmoji'](config['ButtonEmojis']['reOpenTicket'])['setStyle'](config['ButtonColors']['reOpenTicket']),_0x5166bb=new ButtonBuilder()['setCustomId']('createTranscript')['setLabel'](config['Locale']['transcriptButton'])['setEmoji'](config['ButtonEmojis']['createTranscript'])['setStyle'](config['ButtonColors']['createTranscript']),_0x3ca7f3=new ButtonBuilder()['setCustomId']('deleteTicket')['setLabel'](config['Locale']['deleteTicketButton'])['setEmoji'](config['ButtonEmojis']['deleteTicket'])['setStyle'](config['ButtonColors']['deleteTicket']);let _0x43ae29=new ActionRowBuilder()['addComponents'](_0x1a5c72,_0x5166bb,_0x3ca7f3),_0x3f94fa=config['Locale']['ticketClosedBy']['replace'](/{user}/g,'<@!'+_0xac9c6d['user']['id']+'>')['replace'](/{username}/g,''+_0xac9c6d['user']['username']);const _0x465a2f=new EmbedBuilder();_0x465a2f['setColor']('Red'),_0x465a2f['setTitle'](config['Locale']['ticketClosedCloseDM']),_0x465a2f['setDescription'](_0x3f94fa),_0x465a2f['setFooter']({'text':''+_0xac9c6d['user']['username'],'iconURL':''+_0xac9c6d['user']['displayAvatarURL']({'dynamic':!![]})}),_0x465a2f['setTimestamp']();if(config['ArchiveTickets']['ViewClosedTicket']===![])await _0xac9c6d['channel']['permissionOverwrites']['cache']['filter'](_0x4d8959=>_0x4d8959['type']===0x1)['map'](_0x2d8550=>_0x2d8550['delete']());if(config['ArchiveTickets']['ViewClosedTicket'])await _0xac9c6d['channel']['permissionOverwrites']['cache']['filter'](_0x3e101d=>_0x3e101d['type']===0x1&&_0x3e101d['id']!==_0x529c9f['user']['id'])['map'](_0x1159e3=>_0x1159e3['edit']({'SendMessages':![],'ViewChannel':!![]}));let _0x21b36e;await _0xac9c6d['followUp']({'embeds':[_0x465a2f],'components':[_0x43ae29],'ephemeral':![],'fetchReply':!![]})['then'](async function(_0x2bf35f){_0x21b36e=_0x2bf35f['id'];}),await _0x529c9f['tickets']['set'](_0xac9c6d['channel']['id'],_0x21b36e,'archiveMsgID');if(config['ArchiveTickets']['TicketOpenLimit']===![])await _0x529c9f['tickets']['set'](_0xac9c6d['channel']['id'],'Closed','status');if(config['ArchiveTickets']['RenameClosedTicket'])await _0xac9c6d['channel']['setName']('closed-'+_0x489024['username']);if(_0x2dc377==='TicketButton1'){if(config['TicketButton1']['ClosedCategoryID'])await _0xac9c6d['channel']['setParent'](config['TicketButton1']['ClosedCategoryID'],{'lockPermissions':![]});await config['TicketButton1']['SupportRoles']['forEach'](_0x12ecb7=>{role=_0xac9c6d['guild']['roles']['cache']['get'](_0x12ecb7),role&&_0xac9c6d['channel']['permissionOverwrites']['edit'](role,{'SendMessages':![],'ViewChannel':!![]});});}else{if(_0x2dc377==='TicketButton2'){if(config['TicketButton2']['ClosedCategoryID'])await _0xac9c6d['channel']['setParent'](config['TicketButton2']['ClosedCategoryID'],{'lockPermissions':![]});await config['TicketButton2']['SupportRoles']['forEach'](_0x18b700=>{role=_0xac9c6d['guild']['roles']['cache']['get'](_0x18b700),role&&_0xac9c6d['channel']['permissionOverwrites']['edit'](role,{'SendMessages':![],'ViewChannel':!![]});});}else{if(_0x2dc377==='TicketButton3'){if(config['TicketButton3']['ClosedCategoryID'])await _0xac9c6d['channel']['setParent'](config['TicketButton3']['ClosedCategoryID'],{'lockPermissions':![]});await config['TicketButton3']['SupportRoles']['forEach'](_0x3f6926=>{role=_0xac9c6d['guild']['roles']['cache']['get'](_0x3f6926),role&&_0xac9c6d['channel']['permissionOverwrites']['edit'](role,{'SendMessages':![],'ViewChannel':!![]});});}else{if(_0x2dc377==='TicketButton4'){if(config['TicketButton4']['ClosedCategoryID'])await _0xac9c6d['channel']['setParent'](config['TicketButton4']['ClosedCategoryID'],{'lockPermissions':![]});await config['TicketButton4']['SupportRoles']['forEach'](_0x2fc1f8=>{role=_0xac9c6d['guild']['roles']['cache']['get'](_0x2fc1f8),role&&_0xac9c6d['channel']['permissionOverwrites']['edit'](role,{'SendMessages':![],'ViewChannel':!![]});});}else{if(_0x2dc377==='TicketButton5'){if(config['TicketButton5']['ClosedCategoryID'])await _0xac9c6d['channel']['setParent'](config['TicketButton5']['ClosedCategoryID'],{'lockPermissions':![]});await config['TicketButton5']['SupportRoles']['forEach'](_0x541db5=>{role=_0xac9c6d['guild']['roles']['cache']['get'](_0x541db5),role&&_0xac9c6d['channel']['permissionOverwrites']['edit'](role,{'SendMessages':![],'ViewChannel':!![]});});}}}}}}if(config['ArchiveTickets']['Enabled']===!![]&&_0xac9c6d['customId']==='deleteTicket')_0x1d454e();else{if(config['ArchiveTickets']['Enabled']===!![]&&_0xac9c6d['customId']!=='deleteTicket')_0x42c3b5();else config['ArchiveTickets']['Enabled']===![]&&_0x1d454e();}};